services:
  acceptance-tests:
    image: opencloudeu/php-alpine-ci:8.4
    working_dir: /woodpecker/src/github.com/opencloud-eu/opencloud
    command: /bin/bash /test/run-tests.sh
    environment:
      OC_ROOT: /woodpecker/src/github.com/opencloud-eu/opencloud
      TEST_SERVER_URL: ${TEST_SERVER_URL:-https://opencloud-server:9200}
      OC_WRAPPER_URL: http://opencloud-server:5200
      STORAGE_DRIVER: ${STORAGE_DRIVER:-posix}
      BEHAT_SUITE: ${BEHAT_SUITE:-}
      BEHAT_FEATURE: ${BEHAT_FEATURE:-}
      USE_BEARER_TOKEN: ${USE_BEARER_TOKEN:-false}
      # email
      EMAIL_HOST: email
      EMAIL_PORT: 9000
    env_file:
      - ../../../../.woodpecker.env
    volumes:
      - ./run-tests.sh:/test/run-tests.sh
      - ../../../../:/woodpecker/src/github.com/opencloud-eu/opencloud
      - ../../../../vendor-bin/behat/composer.json:/tmp/vendor-bin/behat/composer.json
